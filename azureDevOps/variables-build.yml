parameters:
  - name: deployDev
    type: boolean
  - name: deployQA
    type: boolean

variables:
  ${{ if or(eq(variables['Build.SourceBranch'], 'refs/heads/main'), startsWith(variables['Build.SourceBranch'], 'refs/heads/release/')) }}:
    build.type.release: 'true'
  ${{ if and(ne(variables['Build.SourceBranch'], 'refs/heads/main'), ne(startsWith(variables['Build.SourceBranch'], 'refs/heads/release/'), 'True')) }}:
    build.type.release: 'false'

  # Build.Reason is blank when specifying parameters but Manual when running the pipeline
  ${{ if or(eq(variables['Build.Reason'], ''), eq(variables['Build.Reason'], 'Manual')) }}:
    build.type.manual: 'true'
  ${{ if and(ne(variables['Build.Reason'], ''), ne(variables['Build.Reason'], 'Manual')) }}:
    build.type.manual: 'false'

  ${{ if eq(variables['build.type.manual'], 'true') }}:
    deploy.dev: ${{ parameters.deployDev }}
    deploy.qa: ${{ parameters.deployQA }}
  ${{ if and(ne(variables['build.type.manual'], 'true'), eq(variables['build.type.release'], 'true')) }}:
    deploy.dev: 'true'
    deploy.qa: 'true'
  ${{ if and(ne(variables['build.type.manual'], 'true'), ne(variables['build.type.release'], 'true')) }}:
    deploy.dev: 'false'
    deploy.qa: 'false'

  ${{ if eq(variables['build.type.release'], 'true') }}:
    deploy.staging: 'true'
    deploy.prod: 'true'
  ${{ if ne(variables['build.type.release'], 'true') }}:
    deploy.staging: 'false'
    deploy.prod: 'false'
